<html lang="en">
    <head>
        <title>Chart.js demo</title>
        <!-- import plugin script -->
        <script src='./chart.min2.js'></script>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

        <style>
        .panel-heading{
            background-color: black;
            border-color: black;
            color: white;
        }
        .panel{
            border: 0.5px solid rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .panel-body{
            border-color: black;
        }
        .close{
            color: white;
            opacity: 0.8;
        }
        .close:hover{
            color: white;
            opacity: 1;
        }
        </style>

        <script>
            function binaryIndexOf(searchElement) {
                'use strict';

                var minIndex = 0;
                var maxIndex = this.length - 1;
                var currentIndex;
                var currentElement;
                var resultIndex;

                while (minIndex <= maxIndex) {
                    resultIndex = currentIndex = (minIndex + maxIndex) / 2 | 0;
                    currentElement = this[currentIndex];

                    if (currentElement < searchElement) {
                        minIndex = currentIndex + 1;
                    }
                    else if (currentElement > searchElement) {
                        maxIndex = currentIndex - 1;
                    }
                    else {
                        return currentIndex;
                    }
                }

                return minIndex;
            }

            Array.prototype.binaryIndexOf = binaryIndexOf;
        </script>
    </head>
    <body style="background: #f6f8f8">
        <div class="container">
        <div id="common-nav"></div>
        <script type="text/javascript">
            $("#common-nav").load("/ .navbar", function(){
                $("#common-nav .nav li").each(function(i){
                    if(i==1)
                        $(this).addClass("active");
                    else
                        $(this).removeClass("active")
                });
            });
        </script>
        <div class="row">
            <div class="col-md-6">
                <div class="panel">
                    <div class="panel-heading">
                        <b>Line Graph</b>
                        <span class="close" aria-label="Minimize" onclick="$(this).closest('.panel').children('.panel-body').fadeToggle()">&times;</span>
                    </div>
                    <div class="panel-body">
                        <label for="amount">Price range:</label>
                        <input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;" size="40">
                        <div id="slider-range"></div>
                        <!-- line chart canvas element -->
                        <canvas id="buyers" height="400" width="525" style="width:100%;height:auto;"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel">
                    <div class="panel-heading">
                        <b>Pie Chart</b>
                        <span class="close" aria-label="Minimize" onclick="$(this).closest('.panel').children('.panel-body').fadeToggle()">&times;</span>
                    </div>
                    <div class="panel-body">
                        <!-- pie chart canvas element -->
                       <canvas id="countries" height="400" width="525"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="panel">
                    <div class="panel-heading">
                        <b>Bar Chart</b>
                        <span class="close" aria-label="Minimize" onclick="$(this).closest('.panel').children('.panel-body').fadeToggle()">&times;</span>
                    </div>
                    <div class="panel-body">
                        <!-- bar chart canvas element -->
                        <canvas id="income" height="400" width="525"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel">
                    <div class="panel-heading">
                        <b>Polar Area Chart</b>
                        <span class="close" aria-label="Minimize" onclick="$(this).closest('.panel').children('.panel-body').fadeToggle()">&times;</span>
                    </div>
                    <div class="panel-body">
                        <!-- line chart canvas element -->
                        <canvas id="none" height="400" width="525"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            // line chart data
            var data1,lineChart;
            $.ajax({
                url: '/testData',
                complete: function(data) {
                data1 = data["responseJSON"];
                var buyerData = {
                    labels : ["January","February","March","April","May","June"],
                    datasets : [
                    {
                        fillColor : "rgba(172,194,132,0.4)",
                        strokeColor : "#ACC26D",
                        pointColor : "#fff",
                        pointStrokeColor : "#9DB86D",
                        data : data1
                    }
                    ]
                }
                // get line chart canvas
                var buyers = document.getElementById('buyers').getContext('2d');
                // draw line chart
                lineChart = new Chart(buyers).Line(buyerData,{
                    responsive : false
                });
                }
            });

            // pie chart data
            var pieData = [
                {
                    value : 40,
                    color : "#4ACAB4",
                    highlight: "#29A993",
                    label: "1st Quartile"
                },
                {
                    value : 10,
                    color : "#FF8153",
                    highlight: "#DE6032",
                    label: "Median"
                },
                {
                    value : 30,
                    color : "#FFEA88",
                    highlight: "#EEC967",
                    label: "3rd Quartile"
                }
            ];
            // pie chart options
            var pieOptions = {
                tooltipTemplate: "<%= label %>",
                segmentShowStroke : true,
                animateScale : true,
                showTooltips: true,
        
            }
            // get pie chart canvas
            var countries= document.getElementById("countries").getContext("2d");
            // draw pie chart
            var pieChart = new Chart(countries).Pie(pieData, pieOptions);
            // bar chart data
            var barData = {
                labels : ["January","February","March","April","May","June"],
                datasets : [
                    {
                        fillColor : "#48A497",
                        strokeColor : "#48A4D1",
                        data : [456,479,324,569,702,600]
                    },
                    {
                        fillColor : "rgba(73,188,170,0.4)",
                        strokeColor : "rgba(72,174,209,0.4)",
                        data : [364,504,605,400,345,320]
                    }
                ]
            }
            // get bar chart canvas
            var income = document.getElementById("income").getContext("2d");
            // draw bar chart
            new Chart(income).Bar(barData);
        </script>
        <script>
            (function($){
                windowResize();
                $(window).resize(function(){
                    windowResize();                      
                });         
            })(jQuery);

            function windowResize(){
                $("canvas").css( "width", "100%" );
                $("canvas").css( "height", "auto" );
            }
        </script>
        <script>
        $.ajax({
                url: '/sortedData',
                complete: function(data) {
                    res_date = data["responseJSON"][0];
                    res_value = data["responseJSON"][1];
                    
                    $( "#slider-range" ).slider({
                        range: true,
                        min: res_date[0],
                        max: res_date[res_date.length-1],
                        values: [res_date[0], res_date[res_date.length-1]],
                        slide: function( event, ui ) {
                            $( "#amount" ).val( new Date(ui.values[0]).toLocaleString() + " - " + new Date(ui.values[1]).toLocaleString() );
                            labels = res_date.slice(res_date.binaryIndexOf(ui.values[0]), res_date.binaryIndexOf(ui.values[1])+1);
                            for(i=0; i < labels.length; i++){ 
                                labels[i] = new Date(labels[i]).toLocaleTimeString();
                            }
                            var lineData = {
                                labels : labels,
                                datasets : [
                                {
                                    fillColor : "rgba(172,194,132,0.4)",
                                    strokeColor : "#ACC26D",
                                    pointColor : "#fff",
                                    pointStrokeColor : "#9DB86D",
                                    data : res_value//.slice(res_value.binaryIndexOf(ui.values[0]), res_value.binaryIndexOf(ui.values[1]))
                                }
                                ]
                            }
                            $('#buyers').remove();
                            $('.panel-body').eq(0).append('<canvas id="buyers" height="400" width="525" style="width:100%;height:auto;"></canvas>');
                            var buyers = document.getElementById('buyers').getContext('2d');
                            lineChart = new Chart(buyers).Line(lineData);
                        }
                    });
                    $( "#amount" ).val( new Date($( "#slider-range" ).slider( "values", 0 )).toLocaleString() +
                        " - " + new Date($( "#slider-range" ).slider( "values", 1 ) ).toLocaleString());
                }
            });
        </script>
        </div>
    </body>
</html>